// Copyright (c) 2014 AEFIS, all rights reserved.
// http://www.aefis.com/
"use strict";

if (!aefis) {
	aefis = {};
};

if (!aefis.widgetClasses) {
	aefis.widgetClasses = {};
};

if (!aefis.widget) {
	aefis.widget = {};
};

aefis.widgetClasses.documentrequests = function ($rootContainer) {
	var that = this;
	var $widget = $('#aefis-dashboard-widget--documentrequests');

	this.initialize = function($rootContainer) {
		if (!$rootContainer) {
			$rootContainer = $('body');
		};

		$('#aefis-dashboard-widget--documentrequests').on('refresh', function() {
			that.refreshDocumentRequests();
		})

		$widget.on('AefisWidgetMenuEvent:running', function() {
			aefis.widget.documentrequests.filterDocumentRequests('RUNNING');
		});

		$widget.on('AefisWidgetMenuEvent:all', function() {
			aefis.widget.documentrequests.filterDocumentRequests('ALL');
		})

		$widget.on('AefisWidgetMenuEvent:terminated', function() {
			aefis.widget.documentrequests.filterDocumentRequests('TERMINATED');
		})

		$widget.on('AefisWidgetMenuEvent:completed', function() {
			aefis.widget.documentrequests.filterDocumentRequests('COMPLETED');
		})

		$widget.on('AefisDashboardWidget:refresh', function() {
			that.refreshDocumentRequests();
		})
	};

	this.filterDocumentRequests = function (filterStatus) {
		var count = 0;
		$('#aefis-my-document-empty-result').hide();
		if (filterStatus == 'ALL') {
			$widget.find('li.aefis-mydocument-request').fadeIn().promise().done(function() {
				count = $widget.find('li.aefis-mydocument-request').length;
				//that.updateTotalCount(count);
				if (count == 0) {
					$('#aefis-my-document-empty-result').fadeIn();
				};
			});
		} else {
			$widget.find('.aefis-mydocument-request').fadeOut().promise().done(function() {
				$widget.find('.aefis-mydocument-request.'+filterStatus).fadeIn().promise().done(function() {
					$widget.find('li.aefis-mydocument-request').each(function() {
						var $row = $(this);
						if ($row.css('display') != 'none') {
							count++;
						};
					});
					//that.updateTotalCount(count, aefis.util.toTitleCase(filterStatus));
					if (count == 0) {
						$('#aefis-my-document-empty-result').fadeIn();
					};
				});
			});
		};
		
	};

	this.refreshDocumentRequests = function() {
		var $obj = $('#aefis-mydocument-requests');
		aefis.ui.initializeHandlebarsTemplate($obj);
	};

}