// Copyright (c) 2013 AEFIS, all rights reserved.
// http://www.aefis.com/
"use strict";

if (typeof (aefis) == 'undefined') {
	aefis = {};
};

aefis.PageShared = function () {
	var that = this;

	$('#aefis-survey-instance-refresh-page').off('refresh').on('refresh', function() {
		aefis.ui.loadingShow('#aefis-page-main-container','Refreshing Survey','',true,false);
		window.location.reload();
	});

	this.publish = function(button) {
		var $obj = $(button);
		var url = $obj.attr('data-aefis-datasource');
		var title = $obj.attr('data-aefis-title');
		var content = $obj.attr('data-aefis-content');
		$obj.button('loading');
		var options = {
			title: title,
			content: content,
			successMessage: 'The survey instance was successfully published.',
			errorMessage: 'Error with the publishing the survey instance.',
			confirmAction: url,
			confirmActionName: 'Publish',
			cancelActionName: 'Cancel',
			onConfirm: function() {
				aefis.ui.loadingShow('#aefis-page-main-container','Publishing Survey Instance','',true,false);
			},
			onSuccess: function(returnedData) {
				aefis.ui.loadingHide('#aefis-page-main-container', function() {
					aefis.ui.loadingShow('#aefis-page-main-container','Refreshing Survey Instance','',true,false);
					window.location.reload();
				});
			}
		};
		aefis.ui.confirm(options);
	};

	this.stop = function(el) {
		var $obj = $(el);
		var url = $obj.attr('data-aefis-datasource');
		var content = $obj.attr('data-aefis-content');
		var options = {
				content: content,
				successMessage: 'Survey stopped succesfully.',
				errorMessage: 'Unable to stop survey.',
				confirmAction: url,
				confirmActionName: 'Stop Survey',
				cancelActionName: 'Close',
				onConfirm: function() {
					aefis.ui.loadingShow('#aefis-page-main-container','Stopping Survey','',true,false);
				},
				onSuccess: function() {
					aefis.ui.loadingHide('#aefis-page-main-container', function() {
						aefis.ui.loadingShow('#aefis-page-main-container','Refreshing Survey','',true,false);
						window.location.reload();
					});
				}
			};
		aefis.ui.confirm(options);
	};

	this.cancel = function(el) {
		var $obj = $(el);
		var url = $obj.attr('data-aefis-datasource');
		var content = $obj.attr('data-aefis-content');
		var options = {
				content: content,
				successMessage: 'Survey cancelled succesfully.',
				errorMessage: 'Unable to cancel survey.',
				confirmAction: url,
				confirmActionName: 'Cancel Survey',
				cancelActionName: 'Close',
				onConfirm: function() {
					aefis.ui.loadingShow('#aefis-page-main-container','Cancelling Survey','',true,false);
				},
				onSuccess: function() {
					aefis.ui.loadingHide('#aefis-page-main-container', function() {
						aefis.ui.loadingShow('#aefis-page-main-container','Refreshing Survey','',true,false);
						window.location.reload();
					});
				}
			};
		aefis.ui.confirm(options);
	};

	this.delete = function(el) {
		var $obj = $(el);
		var url = $obj.attr('data-aefis-datasource');
		var content = $obj.attr('data-aefis-content');
		var options = {
				content: content,
				successMessage: 'The Survey was deleted succesfully.',
				errorMessage: 'Unable to delete survey.',
				confirmAction: url,
				confirmActionName: 'Delete Survey',
				cancelActionName: 'Close',
				onConfirm: function() {
					aefis.ui.loadingShow('#aefis-page-main-container','Deleting Survey','',true,false);
				},
				onSuccess: function() {
					aefis.ui.loadingHide('#aefis-page-main-container', function() {
						aefis.ui.loadingShow('#aefis-page-main-container','Loading Survey Manager','',true,false);
						//window.location.reload();
						var redirectUrl = $obj.attr('data-aefis-redirect-url');
						if (redirectUrl) {
							window.location.href = redirectUrl;
						} else {
							window.location.href = '/';
						}						
					});
				}
			};
		aefis.ui.confirm(options);
	};

	this.preview = function(title,url){
		var url = url+'&random='+Math.random();
		var title = '<i class="icon-search"></i>&nbsp;'+title;
		var modalClass = 'modalWidth-900px';
		aefis.ui.modalDialog({title: title,contentURL: url,addModalClass: modalClass,showFooterButton: 'true'});
	};

	this.previewSurveyTemplate = function(el){
		var $obj = $(el);
		var url = $obj.attr('data-aefis-datasource');
		var title = $obj.attr('data-aefis-title');
		var size = $obj.attr('data-aefis-size');
		var titleIconClass = $obj.attr('data-aefis-title-icon-class');
		var totalNumberOfQuestions = $obj.attr('data-aefis-total-questions');

		//if ( totalNumberOfQuestions > 0 ){
			var options = {
				showFooterCloseButton: 'true',
				size: size,
				title: title,
				contentUrl: url
			}

			aefis.ui.modalDialog(options);
	//	} else {
			//aefis.ui.alert(title,'This survey template does not currently have any questions.');
		//};
	}

	this.reopenPartialTerm = function(el) {
		var $obj = $(el);
		var url = $obj.attr('data-aefis-datasource');
		var content = $obj.attr('data-aefis-content');
		var options = {
				content: content,
				successMessage: 'The Survey was re-opened succesfully.',
				errorMessage: 'Unable to re-open survey.',
				confirmAction: url,
				confirmActionName: 'Re-open Survey',
				cancelActionName: 'Close',
				onConfirm: function() {
					aefis.ui.loadingShow('#aefis-page-main-container','Re-opening Survey','',true,false);
				},
				onSuccess: function() {
					aefis.ui.loadingHide('#aefis-page-main-container', function() {
						aefis.ui.loadingShow('#aefis-page-main-container','Loading Survey Manager','',true,false);
						window.location.reload();					
					});
				}
			};
		aefis.ui.confirm(options);
	};

	this.browseIndivdiualResults = function (el) {
		var $obj = $(el);
		var url = $obj.attr("data-aefis-datasource");
		var pageIndex = $("#pageIndex").selectpicker("val");
		url += "&pageIndex=" + pageIndex;

		aefis.ui.loadingShow("#aefis-survey-container", "Loading Results", "", true, false);
		window.location.replace(url);
	};


}